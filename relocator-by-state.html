<script>
  const scriptUrl = 'https://script.google.com/macros/s/AKfycbzQmbKGcjRPjz_mM_pO3sc4B13ZN6X7CJ8dzWLu7I8Hf26rHlXltkQS4RlpyBKsd1gcpQ/exec'; // Your updated web app URL

  // Fetch state and city data
  fetch(scriptUrl)
    .then(response => response.json())
    .then(data => {
      const states = data.states;

      // Populate states dropdown
      const stateSelect = document.getElementById('stateSelect');
      for (const state in states) {
        const option = document.createElement('option');
        option.value = state;
        option.textContent = state;
        stateSelect.appendChild(option);
      };

      // Handle state selection change
      stateSelect.addEventListener('change', (e) => {
        const selectedState = e.target.value;

        // Populate city dropdown based on selected state
        const citySelect = document.getElementById('citySelect');
        citySelect.innerHTML = '<option value="">-- Select City --</option>'; // Reset city dropdown
        citySelect.disabled = !selectedState;

        if (selectedState) {
          const cities = states[selectedState];
          cities.forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city;
            citySelect.appendChild(option);
          });
        }

        // Clear results when state changes
        document.getElementById('relocatorResults').innerHTML = '';
      });
    });

  // Fetch relocators when city is selected
  document.getElementById('citySelect').addEventListener('change', (e) => {
    const selectedState = document.getElementById('stateSelect').value;
    const selectedCity = e.target.value;

    if (selectedState && selectedCity) {
      fetch(scriptUrl, {
        method: 'POST',
        body: JSON.stringify({ state: selectedState, city: selectedCity }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(response => response.json())
      .then(data => {
        const relocators = data.relocators;
        const resultsDiv = document.getElementById('relocatorResults');
        resultsDiv.innerHTML = '';

        if (relocators.length > 0) {
          relocators.forEach(relocator => {
            const div = document.createElement('div');
            div.textContent = `${relocator.name} - ${relocator.phone}`;
            resultsDiv.appendChild(div);
          });
        } else {
          resultsDiv.innerHTML = 'No relocators found for this city.';
        }
      });
    }
  });
</script>
