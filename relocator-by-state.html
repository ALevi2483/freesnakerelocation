<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Find a Snake Relocator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    select {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      margin-bottom: 20px;
    }
    #relocatorResults {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Find a Snake Relocator</h1>

  <label for="stateSelect">Select State:</label>
  <select id="stateSelect">
    <option value="">-- Select State --</option>
  </select>

  <label for="citySelect">Select City:</label>
  <select id="citySelect" disabled>
    <option value="">-- Select City --</option>
  </select>

  <div id="relocatorResults"></div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const scriptUrl = 'https://script.google.com/macros/s/AKfycbw23mzM9CnkyVeoQ5Oq_o-F32tq62Z_EOq8G9d5yIE1lq0eL3hH5V0zpycezeL5TKYg1g/exec'; // Your updated web app URL

      // Fetch state and city data
      fetch(scriptUrl)
        .then(response => response.json())
        .then(data => {
          const states = data;  // This will return all states and cities.

          // Populate states dropdown
          const stateSelect = document.getElementById('stateSelect');
          for (const state in states) {
            const option = document.createElement('option');
            option.value = state;
            option.textContent = state;
            stateSelect.appendChild(option);
          }

          // Handle state selection change
          stateSelect.addEventListener('change', (e) => {
            const selectedState = e.target.value;

            // Populate city dropdown based on selected state
            const citySelect = document.getElementById('citySelect');
            citySelect.innerHTML = '<option value="">-- Select City --</option>'; // Reset city dropdown
            citySelect.disabled = !selectedState;

            if (selectedState) {
              const cities = states[selectedState];
              cities.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                citySelect.appendChild(option);
              });
            }

            // Clear results when state changes
            document.getElementById('relocatorResults').innerHTML = '';
          });

          // Fetch relocators when city is selected
          document.getElementById('citySelect').addEventListener('change', (e) => {
            const selectedState = document.getElementById('stateSelect').value;
            const selectedCity = e.target.value;

            if (selectedState && selectedCity) {
              // Fetch the relocators for the selected city and state
              fetch(scriptUrl, {
                method: 'POST',
                body: JSON.stringify({ state: selectedState, city: selectedCity }),
                headers: { 'Content-Type': 'application/json' }
              })
              .then(response => response.json())
              .then(data => {
                const relocators = data[selectedState] && data[selectedState][selectedCity] || [];
                const resultsDiv = document.getElementById('relocatorResults');
                resultsDiv.innerHTML = '';

                if (relocators.length > 0) {
                  relocators.forEach(relocator => {
                    const div = document.createElement('div');
                    div.textContent = `${relocator.name} - ${relocator.phone}`;
                    resultsDiv.appendChild(div);
                  });
                } else {
                  resultsDiv.innerHTML = 'No relocators found for this city.';
                }
              });
            }
          });
        });
    });
  </script>
</body>
</html>
