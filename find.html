<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Find a Snake Relocator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f9f5;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .content-wrapper {
      max-width: 1000px;
      margin: 40px auto;
      padding: 0 20px;
    }
    h1, h2, h3 {
      color: #225533;
    }
    select, button, input {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      margin-bottom: 20px;
    }
    .section {
      display: none;
    }
    iframe {
      width: 100%;
      height: 800px;
      border: none;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    a {
      color: blue;
      text-decoration: underline;
      cursor: pointer;
    }
    .notice-banner {
      background-color: #ffefc2;
      border: 2px solid #cc9933;
      padding: 15px;
      margin: 20px 0;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: bold;
      color: #663300;
      display: none;
    }
    #disclaimerText {
      background-color: #fff8e1;
      border: 1px solid #d6b700;
      padding: 15px;
      margin: 20px 0;
      border-radius: 8px;
      display: none;
    }
    .agree-button {
      background-color: #225533;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="content-wrapper">
    <h1>Find a Snake Relocator</h1>

    <p><a id="showDisclaimerLink" onclick="toggleDisclaimer()">üìú Read Disclaimer</a></p>
    <div id="disclaimerText">
      <p><strong>DISCLAIMER:</strong> This directory is provided as a public service. We do not vet or monitor listed volunteers. You are solely responsible for verifying the qualifications and trustworthiness of anyone you contact. Use at your own risk.</p>
      <button class="agree-button" onclick="agreeDisclaimer()">I Agree</button>
    </div>

    <div class="notice-banner" id="noticeBanner">
      üì± Text the number instead of calling. Many people do not answer unknown numbers.
    </div>

    <div id="searchOptions" style="display:none;">
      <p><strong>Choose how you want to search:</strong></p>
      <select id="searchMethod" onchange="handleSearchMethodChange()">
        <option value="">-- Select Search Method --</option>
        <option value="closest">Find Closest (by Address or GPS)</option>
        <option value="map">View Relocator Map</option>
        <option value="stateCity">Search by State & City</option>
      </select>

      <div id="closest" class="section">
        <h2>Find Closest (by Address or GPS)</h2>
        <label for="addressInput">Address:</label>
        <input type="text" id="addressInput" placeholder="123 Main St, City, State" />
        <button onclick="findByAddress()">üîç Search by Address</button>
        <div id="addressOutput" style="margin-top:15px;"></div>

        <div id="gpsResults" style="margin: 40px 0 20px;">
          <h3>Or Use My Location</h3>
          <button onclick="findByGPS()">üìç Use Current Location</button>
          <div id="gpsOutput" style="margin-top:15px;"></div>
        </div>
      </div>

      <div id="map" class="section">
        <h2>Find a Relocator on the Map</h2>
        <iframe src="https://www.google.com/maps/d/embed?mid=1__R7DSwXpME1vtvTbOTOBlZXV6CsO3w" allowfullscreen></iframe>
      </div>

      <div id="stateCity" class="section">
        <h2>Find a Relocator by State & City</h2>
        <label for="stateSelect">Select State:</label>
        <select id="stateSelect" onchange="populateCities()">
          <option value="">--Select State--</option>
        </select>
        <label for="citySelect">Select City:</label>
        <select id="citySelect" onchange="showResults()">
          <option value="">--Select City--</option>
        </select>
        <div id="stateCityResults" style="margin-top: 20px;"></div>
      </div>
    </div>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxtmz0CoI5iva6whiEXgRw5IMA1MRYj2-4y9E7DXLtWccCYRmhq3G1bFFDpXeKqRkjPWw/exec';
    let data = [];

    fetch(`${scriptURL}?address=ping`)
      .then(res => res.json())
      .then(json => {
        data = json.filter(r => r.State && r.City);
        const states = [...new Set(data.map(r => r.State))].sort();
        const stateSelect = document.getElementById('stateSelect');
        stateSelect.innerHTML = '<option value="">--Select State--</option>';
        states.forEach(state => {
          const opt = document.createElement('option');
          opt.value = state;
          opt.textContent = state;
          stateSelect.appendChild(opt);
        });
      });

    function toggleDisclaimer() {
      const d = document.getElementById("disclaimerText");
      d.style.display = d.style.display === "none" ? "block" : "none";
    }

    function agreeDisclaimer() {
      localStorage.setItem("disclaimerAccepted", "true");
      document.getElementById("disclaimerText").style.display = "none";
      document.getElementById("searchOptions").style.display = "block";
    }

    window.onload = () => {
      if (localStorage.getItem("disclaimerAccepted") === "true") {
        document.getElementById("searchOptions").style.display = "block";
      }
    };

    function populateCities() {
      const selectedState = document.getElementById('stateSelect').value;
      const cities = [...new Set(data.filter(r => r.State === selectedState).map(r => r.City))].sort();
      const citySelect = document.getElementById('citySelect');
      citySelect.innerHTML = '<option value="">--Select City--</option>';
      cities.forEach(city => {
        const opt = document.createElement('option');
        opt.value = city;
        opt.textContent = city;
        citySelect.appendChild(opt);
      });
      document.getElementById('stateCityResults').innerHTML = '';
    }

    function showResults() {
      const state = document.getElementById('stateSelect').value;
      const city = document.getElementById('citySelect').value;
      const filtered = data.filter(r => r.State === state && r.City === city);
      const resultDiv = document.getElementById('stateCityResults');
      resultDiv.innerHTML = filtered.map(r =>
        `<div><strong>${r["Full Name"]}</strong> ‚Äì ${r["Phone"]}` +
        (r["Distance"] ? `<br><small>${Number(r["Distance"]).toFixed(1)} mi away</small>` : '') +
        `</div>`
      ).join('<br><br>');
    }

    function handleSearchMethodChange() {
      const value = document.getElementById('searchMethod').value;
      if (!value) return;
      document.getElementById("noticeBanner").style.display = "block";
      const sections = document.getElementsByClassName('section');
      for (let i = 0; i < sections.length; i++) {
        sections[i].style.display = 'none';
      }
      document.getElementById(value).style.display = 'block';
    }

    async function findByGPS() {
      const output = document.getElementById("gpsOutput");
      output.innerHTML = "Locating you...";
      if (!navigator.geolocation) {
        output.innerHTML = "Your browser does not support GPS location.";
        return;
      }
      navigator.geolocation.getCurrentPosition(async position => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;
        const url = `${scriptURL}?lat=${lat}&lng=${lng}`;
        try {
          const res = await fetch(url);
          const data = await res.json();
          output.innerHTML = data.map(r =>
            `<div><strong>${r["Full Name"]}</strong> ‚Äì ${r["Phone"]}<br><small>${Number(r["Distance"]).toFixed(1)} mi away</small></div>`
          ).join('<br><br>');
        } catch {
          output.innerHTML = "Could not retrieve results.";
        }
      }, () => {
        output.innerHTML = "GPS access denied or unavailable.";
      });
    }

    async function findByAddress() {
      const output = document.getElementById("addressOutput");
      const address = document.getElementById("addressInput").value.trim();
      if (!address) {
        output.innerHTML = "Please enter a full address.";
        return;
      }
      output.innerHTML = "Searching...";
      try {
        const res = await fetch(`${scriptURL}?address=${encodeURIComponent(address)}`);
        const data = await res.json();
        output.innerHTML = data.map(r =>
          `<div><strong>${r["Full Name"]}</strong> ‚Äì ${r["Phone"]}<br><small>${Number(r["Distance"]).toFixed(1)} mi away</small></div>`
        ).join('<br><br>');
      } catch {
        output.innerHTML = "Could not retrieve results.";
      }
    }
  </script>
</body>
</html>
