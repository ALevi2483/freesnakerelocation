<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Find a Snake Relocator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f9f5;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .content-wrapper {
      max-width: 1000px;
      margin: 40px auto;
      padding: 0 20px;
    }
    h1, h2, h3 {
      color: #225533;
    }
    select, button {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      margin-bottom: 20px;
    }
    .section {
      display: none;
    }
    iframe {
      width: 100%;
      height: 800px;
      border: none;
    }
    .disclaimer-box {
      background-color: #eef5ee;
      border: 1px solid #cfcfcf;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    a {
      color: blue;
      text-decoration: underline;
      cursor: pointer;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }
    .modal-content {
      position: relative;
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      width: 80%;
      max-width: 700px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
    }
    .close-button {
      position: absolute;
      top: 10px;
      right: 15px;
      background-color: #225533;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      z-index: 1001;
    }
  </style>
  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyQFYbdIPk8SkjERSvqQMX2ococTDIZtMBVx0T9Oc0AG97fe0TJNdSCNJAS47oEojwZ/exec';

    function showSection() {
      var selection = document.getElementById('searchMethod').value;
      var sections = document.getElementsByClassName('section');
      for (var i = 0; i < sections.length; i++) {
        sections[i].style.display = 'none';
      }
      if (selection) {
        document.getElementById(selection).style.display = 'block';
      }
    }

    function showDisclaimer() {
      document.getElementById('disclaimerModal').style.display = 'block';
    }

    function closeDisclaimer() {
      document.getElementById('disclaimerModal').style.display = 'none';
    }

    let data = [];
    fetch(`${scriptURL}?address=ping`)
      .then(res => res.json())
      .then(json => {
        data = json;
        const states = [...new Set(data.map(r => r.State))].sort();
        const stateSelect = document.getElementById('stateSelect');
        states.forEach(state => {
          const opt = document.createElement('option');
          opt.value = state;
          opt.textContent = state;
          stateSelect.appendChild(opt);
        });
      });

    function populateCities() {
      const selectedState = document.getElementById('stateSelect').value;
      const cities = [...new Set(data.filter(r => r.State === selectedState).map(r => r.City))].sort();
      const citySelect = document.getElementById('citySelect');
      citySelect.innerHTML = '<option value="">--Select City--</option>';
      cities.forEach(city => {
        const opt = document.createElement('option');
        opt.value = city;
        opt.textContent = city;
        citySelect.appendChild(opt);
      });
      document.getElementById('stateCityResults').innerHTML = '';
    }

    function showResults() {
      const state = document.getElementById('stateSelect').value;
      const city = document.getElementById('citySelect').value;
      const filtered = data.filter(r => r.State === state && r.City === city);
      const resultDiv = document.getElementById('stateCityResults');
      resultDiv.innerHTML = filtered.map(r =>
        `<div><strong>${r["Full Name"]}</strong> ‚Äì ${r["Phone"]}</div>`
      ).join('');
    }

    async function findByGPS() {
      const output = document.getElementById("gpsOutput");
      output.innerHTML = "Locating you...";

      if (!navigator.geolocation) {
        output.innerHTML = "Your browser does not support GPS location.";
        return;
      }

      navigator.geolocation.getCurrentPosition(async position => {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        const url = `${scriptURL}?lat=${lat}&lng=${lng}`;

        try {
          const res = await fetch(url);
          const data = await res.json();

          if (data.length === 0) {
            output.innerHTML = "No relocators found near you.";
          } else {
            output.innerHTML = data.map(r =>
              `<div><strong>${r["Full Name"]}</strong> ‚Äì ${r["Phone"]}<br><small>${r["Distance"]} mi away</small></div>`
            ).join('<br><br>');
          }
        } catch (err) {
          output.innerHTML = "Error retrieving data. Please try again later.";
        }
      }, () => {
        output.innerHTML = "GPS access was denied or not available.";
      });
    }
  </script>
</head>
<body>
  <div class="content-wrapper">
    <h1>Find a Snake Relocator</h1>

    <div class="disclaimer-box">
      <div style="font-weight:bold; margin-bottom:10px;">‚ö†Ô∏è Important: Read the Disclaimer Before Proceeding</div>
      <p>Before proceeding, please <a onclick="showDisclaimer()">READ THIS DISCLAIMER</a>.</p>
      <p><strong>The Free Snake Relocation Directory and its administrators are not responsible for any injuries, damages, or legal matters</strong> resulting from any relocation efforts. Volunteers operate independently, and it is the responsibility of both parties (homeowners and volunteers) to ensure proper communication, safety, and compliance with local laws.</p>
    </div>

    <p><strong>Choose how you want to search:</strong></p>
    <select id="searchMethod" onchange="showSection()">
      <option value="">-- Select Search Method --</option>
      <option value="closest">Find Closest Relocator</option>
      <option value="map">View Relocator Map</option>
      <option value="stateCity">Search by State & City</option>
    </select>

    <div id="closest" class="section">
      <h2>Find the Closest Snake Relocators</h2>
      <p>Enter your address below or use your device‚Äôs GPS to find the closest volunteer snake relocators. <strong>Do not enter just your zip code.</strong></p>
      <iframe src="https://script.google.com/macros/s/AKfycbyQFYbdIPk8SkjERSvqQMX2ococTDIZtMBVx0T9Oc0AG97fe0TJNdSCNJAS47oEojwZ/exec" title="Closest Snake Relocator Finder"></iframe>
      <div id="gpsResults" style="margin: 20px 0;">
        <h3>Or Use My Location</h3>
        <button onclick="findByGPS()">üìç Use Current Location</button>
        <div id="gpsOutput" style="margin-top:15px; font-weight:normal;"></div>
      </div>
    </div>

    <div id="map" class="section">
      <h2>Find a Relocator on the Map</h2>
      <iframe src="https://www.google.com/maps/d/embed?mid=1__R7DSwXpME1vtvTbOTOBlZXV6CsO3w" allowfullscreen title="Relocator Map"></iframe>
    </div>

    <div id="stateCity" class="section">
      <h2>Find a Relocator by State & City</h2>
      <label for="stateSelect">Select State:</label>
      <select id="stateSelect" onchange="populateCities()">
        <option value="">--Select State--</option>
      </select>
      <label for="citySelect">Select City:</label>
      <select id="citySelect" onchange="showResults()">
        <option value="">--Select City--</option>
      </select>
      <div id="stateCityResults" style="margin-top: 20px;"></div>
    </div>
  </div>

  <div id="disclaimerModal" class="modal">
    <div class="modal-content">
      <button class="close-button" onclick="closeDisclaimer()">X</button>
      <h2>Free Snake Relocation Directory ‚Äì Disclaimer</h2>
      <p><strong>By using this platform, you agree to release and hold harmless the Free Snake Relocation Directory and its administrators from any injury, loss, or liability resulting from interaction with a volunteer relocator.</strong></p>
    </div>
  </div>
</body>
</html>
